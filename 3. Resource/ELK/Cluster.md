## Cluster
Node들의 집합으로, 데이터를 분산처리하고 확장성 및 고가용성을 제공한다.


### Cluster의 주요 기능
- 확장성 확보 및 데이터 분산 처리
  - 여러 노드들이 각 샤드(Shard)에서 데이터를 분산 처리하여, 고성능의 서비스 가능
  - 샤드는 물리적인 단위로 데이터가 저장되기 때문에, 단일 노드 환경에서는 분산 처리 불가능.
  - 샤드가 1개라면 노드를 추가해도 데이터 분산이 이루어지지 않아 확장성 확보 어려움.
- 고가용성
  - 여러 노드에 복제본(Replica)을 저장하여, 특정 노드에서 장애가 발생하더라도 지속적인 서비스 가능.
  - 복제본(Replica)을 여러 개 설정해야 고가용성 확보 가능.
  - 복제본이 1개라면 특정 노드 장애 시 고가용성 보장 어려움.


### Cluster의 설정 및 관리
- 클러스터 설정 파일
  - 설정 파일은 `elasticsearch.yml`에서 관리.
  - 클러스터 이름, 노드 이름, 샤드 및 복제본 설정 등 주요 설정을 포함.
- 노드 추가 및 제거
  - 노드수가 변경되면 클러스터가 자동으로 데이터를 재분배.  
    이 과정에서 클러스터 상태가 `yellow`나 `red`로 바뀔 수 있으므로, 재분배 완료될때까지 잠시 기다려야함
  - 노드 제거 시 데이터 손실을 방지하기 위해 Replica를 줄여야함
- 클러스터 상태 모니터링
  - Kibana나 API를 통해 클러스터 상태를 실시간으로 모니터링 가능.
  - **green**: 모든 샤드가 정상적으로 할당된 상태
  - **yellow**: 모든 `Primary 샤드`는 할당되었지만, 일부 `Replica 샤드`가 할당되지 않은 상태. 데이터 손실은 없지만, 고가용성이 보장되지 않는 상태
  - **red**: 일부 `Primary 샤드`가 할당되지 않은 상태. 데이터 손실 가능성이 있음
  

### Cluster의 성능 최적화
- 샤드 크기를 적절히 설정하여 관리 오버헤드 최소화.
  - 샤드의 크기가 너무 작으면 오버헤드가 증가하고, 너무 크면 성능이 저하될 수 있음
- 복제본 수를 적절히 조정하여 읽기 성능과 고가용성 확보.
  - 복제본 수가 노드 수보다 많아지면 비활성 Replica가 발생하여 클러스터 상태가 `yellow`로 표시될 수 있음.
  - 비활성 Replica는 고가용성을 저해하고, 리소스를 낭비하며, 노드 추가 시 복구 지연 가능성이 있음.
